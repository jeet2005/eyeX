<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports | AttendAI</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Plus+Jakarta+Sans:wght@600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/static/css/modern.css">
</head>

<body>
    <aside class="sidebar">
        <div class="logo">
            <img src="/static/images/eye-x-logo.svg" alt="Logo">
            <span>AttendAI</span>
        </div>

        <ul class="nav-menu">
            <a href="/" style="text-decoration: none;">
                <li class="nav-item"><i class="fas fa-th-large"></i> Dashboard</li>
            </a>
            <a href="/students" style="text-decoration: none;">
                <li class="nav-item"><i class="fas fa-users"></i> Students</li>
            </a>
            <a href="/attendance" style="text-decoration: none;">
                <li class="nav-item"><i class="fas fa-calendar-check"></i> Attendance</li>
            </a>
            <a href="/reports" style="text-decoration: none;">
                <li class="nav-item active"><i class="fas fa-chart-line"></i> Analytics</li>
            </a>
        </ul>

        <div
            style="margin-top: auto; padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 12px; display: flex; align-items: center; gap: 0.8rem;">
            <div class="avatar" style="width: 32px; height: 32px;">A</div>
            <div style="font-size: 0.8rem;">
                <div style="font-weight: bold;">Admin User</div>
                <div style="color: var(--text-secondary);">System Admin</div>
            </div>
        </div>
    </aside>

    <main class="main-content">
        <header class="header">
            <div>
                <h1>Analytics & Reports</h1>
                <p style="color: var(--text-secondary);">Attendance insights and trends</p>
            </div>
            <div class="date-badge">This Week <i class="fas fa-chevron-down"></i></div>
        </header>

        <!-- Analytics Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <div class="stat-title">Avg Attendance</div>
                    <div class="btn-icon"
                        style="border: none; background: rgba(0,210,211,0.1); color: var(--accent-primary);"><i
                            class="fas fa-location-arrow"></i></div>
                </div>
                <div class="stat-value">--%</div>
                <div class="stat-trend trend-up">Current System Avg</div>
            </div>
            <div class="stat-card">
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <div class="stat-title">Peak Hour</div>
                    <div class="btn-icon"
                        style="border: none; background: rgba(95,39,205,0.1); color: var(--accent-secondary);"><i
                            class="far fa-clock"></i></div>
                </div>
                <div class="stat-value">8:00 AM</div>
                <div class="stat-trend">Most check-ins</div>
            </div>
            <div class="stat-card">
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <div class="stat-title">Recognition Rate</div>
                    <div class="btn-icon"
                        style="border: none; background: rgba(16,185,129,0.1); color: var(--success);"><i
                            class="fas fa-user-check"></i></div>
                </div>
                <div class="stat-value">98.2%</div>
                <div class="stat-trend trend-up">System Accuracy</div>
            </div>
        </div>

        <!-- Charts -->
        <div class="chart-card" style="margin-top: 2rem;">
            <h3>Weekly Attendance Overview</h3>
            <div style="height: 350px; margin-top: 1rem;">
                <canvas id="weeklyChart"></canvas>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Init Chart
            const ctx = document.getElementById('weeklyChart');
            const weeklyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [
                        { label: 'Present', data: [], backgroundColor: '#10b981', borderRadius: 6 },
                        { label: 'Absent', data: [], backgroundColor: '#ef4444', borderRadius: 6 },
                        { label: 'Late', data: [], backgroundColor: '#f59e0b', borderRadius: 6 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'top' } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.05)' } },
                        x: { grid: { display: false } }
                    }
                }
            });

            // Fetch Data
            try {
                // 1. Weekly Trends
                const res = await fetch('/api/analytics/weekly');
                const data = await res.json();

                weeklyChart.data.labels = data.labels;
                weeklyChart.data.datasets[0].data = data.present;
                weeklyChart.data.datasets[1].data = data.absent;
                weeklyChart.data.datasets[2].data = data.late;
                weeklyChart.update();

                // 2. Summary Stats (Today)
                const statsRes = await fetch('/api/attendance/stats');
                const stats = await statsRes.json();

                // Update percentage on card if element exists
                const avgCard = document.querySelector('.stat-value'); // First card
                if (avgCard && stats.attendance_percentage !== undefined) {
                    avgCard.textContent = Math.round(stats.attendance_percentage) + '%';
                }

            } catch (e) {
                console.error("Error loading analytics:", e);
            }
        });
    </script>
</body>

</html>